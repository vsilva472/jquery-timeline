"use strict";(function(o,i){function Plugin(t,i){this.options=o.extend({},o.fn.timeline.defaults,i);this.options.container=o(this.options.container);this.resolveApiUrl().resolveRawContentOption();this.init()}Plugin.prototype.init=function(){this.dispatch("timeline.start");this.fetch(this.options.apiUrl)};Plugin.prototype.resolveApiUrl=function(){var t=this.options.container.data("timeline");if(!this.options.apiUrl&&!t)throw new Error("No api url found");if(!this.options.apiUrl)this.options.apiUrl=t;return this};Plugin.prototype.resolveRawContentOption=function(){var t=this.options.container.data("timeline-allow-raw-content");if(!this.options.allowRawContent&&!t)this.options.allowRawContent=false;if(t!==i)this.options.allowRawContent=!!t;return this};Plugin.prototype.fetch=function(t){this.dispatch("timeline.ajax.before");var n=this,i=o.getJSON(t,function(){});i.done(function(t){n.buildWith(t)});i.fail(function(t,i,e){n.dispatch("timeline.ajax.fail",{jqXHR:t,textStatus:i,errorThrown:e})});i.always(function(){n.dispatch("timeline.ajax.complete")})};Plugin.prototype.buildWith=function(t){var e=this,n=this.options.transformer(t);Object.keys(n).forEach(function(t){e.createYearLabel(t).appendTo(e.options.container);var i=o("<div />").addClass("timeline-item-wrapper");n[t].forEach(function(t){e.createItem(t).appendTo(i)});i.appendTo(e.options.container)});this.options.container.append('<span class="timeline-end timeline-item">');this.dispatch("timeline.after.generate")};Plugin.prototype.createYearLabel=function(t){var i=o("<div />").addClass("timeline-year-container timeline-item");o("<span />").addClass("timeline-year-label").text(t).appendTo(i);return i};Plugin.prototype.createTitle=function(t){var i=t.link?o("<a />").attr({href:t.link.trim(),target:"_blank"}).addClass("timeline-item-title timeline-item").text(t.title.trim()):o("<div />").addClass("timeline-item-title timeline-item").text(t.title.trim());return i};Plugin.prototype.createImage=function(t){var i=t.image?o("<img />").attr("src",t.image.trim()).addClass("timeline-item-image timeline-item"):null;if(!t.link)return i;if(i)return o("<a />").attr({href:t.link.trim(),target:"_blank"}).append(i)};Plugin.prototype.createDescription=function(t){var i=t.description?o("<p />").addClass("timeline-item-description timeline-item"):null;var e=this.prepareContent(t.description);if(i&&t.link)o("<a />").attr({href:t.link.trim(),target:"_blank"}).append(e).appendTo(i);else if(i)i.append(e);return i};Plugin.prototype.prepareContent=function(t){if(this.options.allowRawContent)return o("<span />").html(t);return o("<span />").text(t)};Plugin.prototype.createItem=function(t){var i=o("<div />").addClass("timeline-item-container");var e=o("<div />").addClass("timeline-item-body");var n=this.createImage(t);var a=this.createDescription(t);this.createTitle(t).appendTo(i);if(n)n.appendTo(e);if(a)a.appendTo(e);e.appendTo(i);return i};Plugin.prototype.dispatch=function(t,i){this.options.container.trigger(t,i)};o.fn.timeline=function(t){return this.each(function(){if(!o.data(this,"plugin")){o.data(this,"plugin",new Plugin(this,t))}})};o.fn.timeline.defaults={container:"[data-timeline]",apiUrl:null,allowRawContent:false,transformer:function(t){return t}};o(document).ready(function(){o(o.fn.timeline.defaults.container).on("timeline.after.generate",function(){o(this).addClass("timeline")}).timeline()})})(jQuery,undefined);