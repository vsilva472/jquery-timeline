"use strict";(function(r,i){function Plugin(t,i){this.$container=r(t);this.options=r.extend({},r.fn.timeline.defaults,i);this.resolveApiUrl().resolveRawContentOption();this.init()}Plugin.prototype.init=function(){this.dispatch("timeline.start");this.fetch(this.options.apiUrl)};Plugin.prototype.resolveApiUrl=function(){var t=this.$container.data("timeline");if(!this.options.apiUrl&&!t)throw new Error("No api url found");if(!this.options.apiUrl)this.options.apiUrl=t;return this};Plugin.prototype.resolveRawContentOption=function(){var t=this.$container.data("timeline-allow-raw-content");if(!this.options.allowRawContent&&!t)this.options.allowRawContent=false;if(t!==i)this.options.allowRawContent=!!t;return this};Plugin.prototype.fetch=function(t){this.dispatch("timeline.ajax.before");var n=this,i=r.getJSON(t,function(){});i.done(function(t){n.dispatch("timeline.before.generate",{data:t});n.buildWith(t)});i.fail(function(t,i,e){n.dispatch("timeline.ajax.fail",{jqXHR:t,textStatus:i,errorThrown:e})});i.always(function(){n.dispatch("timeline.ajax.complete")})};Plugin.prototype.buildWith=function(e){var n=this;Object.keys(e).forEach(function(t){n.createYearLabel(t).appendTo(n.$container);var i=r("<div />").addClass("timeline-item-wrapper");e[t].forEach(function(t){n.createItem(t).appendTo(i)});i.appendTo(n.$container)});this.$container.append('<span class="timeline-end timeline-item">');this.dispatch("timeline.after.generate")};Plugin.prototype.createYearLabel=function(t){var i=r("<div />").addClass("timeline-year-container timeline-item");r("<span />").addClass("timeline-year-label").text(t).appendTo(i);return i};Plugin.prototype.createTitle=function(t){var i=t.link?r("<a />").attr({href:t.link.trim(),tagert:"_blank"}).addClass("timeline-item-title timeline-item").text(t.title.trim()):r("<div />").addClass("timeline-item-title timeline-item").text(t.title.trim());return i};Plugin.prototype.createImage=function(t){var i=t.image?r("<img />").attr("src",t.image.trim()).addClass("timeline-item-image timeline-item"):null;if(!t.link)return i;if(i)return r("<a />").attr({href:t.link.trim(),target:"_blank"}).append(i)};Plugin.prototype.createDescription=function(t){var i=t.description?r("<p />").addClass("timeline-item-description timeline-item"):null;var e=this.prepareContent(t.description);if(i&&t.link)r("<a />").attr({href:t.link.trim(),target:"_blank"}).append(e).appendTo(i);else if(i)i.append(e);return i};Plugin.prototype.prepareContent=function(t){if(this.options.allowRawContent)return r("<span />").html(t);return r("<span />").text(t)};Plugin.prototype.createItem=function(t){var i=r("<div />").addClass("timeline-item-container");var e=r("<div />").addClass("timeline-item-body");var n=this.createImage(t);var a=this.createDescription(t);this.createTitle(t).appendTo(i);if(n)n.appendTo(e);if(a)a.appendTo(e);e.appendTo(i);return i};Plugin.prototype.dispatch=function(t,i){this.$container.trigger(t,i)};r.fn.timeline=function(t){return this.each(function(){if(!r.data(this,"plugin")){r.data(this,"plugin",new Plugin(this,t))}})};r.fn.timeline.defaults={container:"[data-timeline]",apiUrl:null,allowRawContent:false};r(document).ready(function(){r(r.fn.timeline.defaults.container).on("timeline.after.generate",function(){r(this).addClass("timeline")}).timeline()})})(jQuery,undefined);